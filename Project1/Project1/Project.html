<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Projets</title>
    <style>
        :root {
            --bg: #050608;
            --accent: #5b8cff;
            --accent-purple: #a855f7;
            --text: #f5f5f5;
            --muted: #9ca3af;
            --radius-lg: 18px;
            --radius-full: 999px;
            --shadow-soft: 0 18px 45px rgba(0,0,0,.55);
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* ── PARTICLES ── */
        #particles {
            position: fixed;
            inset: 0;
            z-index: 0;
            opacity: .4;
            pointer-events: none;
        }

        /* ── HEADER ── */
        .main-header {
            padding: 1.5rem clamp(1.5rem,4vw,4rem);
            position: sticky;
            top: 0;
            background: rgba(5,6,8,.85);
            backdrop-filter: blur(20px);
            z-index: 200;
            border-bottom: 1px solid rgba(148,163,184,.1);
        }

        .nav {
            display: flex;
            justify-content: center;
            align-items: center;
            max-width: 1120px;
            margin: 0 auto;
            position: relative;
        }

        .nav__links {
            list-style: none;
            display: flex;
            gap: 1.5rem;
        }

            .nav__links a {
                position: relative;
                color: var(--muted);
                font-size: .92rem;
                text-decoration: none;
                transition: color .3s;
            }

                .nav__links a::after {
                    content: "";
                    position: absolute;
                    left: 0;
                    bottom: -.2rem;
                    width: 0;
                    height: 2px;
                    background: linear-gradient(90deg, var(--accent), var(--accent-purple));
                    border-radius: var(--radius-full);
                    transition: width .3s;
                }

                .nav__links a:hover, .nav__links a.active {
                    color: var(--text);
                }

                    .nav__links a:hover::after, .nav__links a.active::after {
                        width: 100%;
                    }

        .nav__toggle {
            position: absolute;
            right: 0;
            display: none;
            flex-direction: column;
            gap: .25rem;
            background: transparent;
            border: none;
            cursor: pointer;
        }

            .nav__toggle span {
                width: 22px;
                height: 2px;
                border-radius: var(--radius-full);
                background: #e5e7eb;
                display: block;
            }

        /* ── PAGE HERO ── */
        .page-hero {
            max-width: 1120px;
            margin: 3.5rem auto 0;
            padding: 0 clamp(1.5rem,4vw,4rem);
            text-align: center;
            position: relative;
            z-index: 1;
            animation: fadeUp .7s ease both;
        }

            .page-hero h1 {
                font-size: clamp(2.2rem,5vw,3.5rem);
                font-weight: 800;
                line-height: 1.1;
                margin-bottom: .7rem;
            }

                .page-hero h1 span {
                    background: linear-gradient(135deg, var(--accent), var(--accent-purple));
                    -webkit-background-clip: text;
                    background-clip: text;
                    -webkit-text-fill-color: transparent;
                }

            .page-hero p {
                color: var(--muted);
                font-size: 1.05rem;
            }

        /* ── FILTER BAR ── */
        .filter-section {
            max-width: 1120px;
            margin: 2rem auto 0;
            padding: 0 clamp(1.5rem,4vw,4rem);
            position: relative;
            z-index: 1;
        }

        .filter-wrapper {
            display: flex;
            flex-wrap: wrap;
            gap: .6rem;
            justify-content: center;
            padding: 1.1rem 1.4rem;
            background: rgba(15,23,42,.7);
            border: 1px solid rgba(148,163,184,.18);
            border-radius: var(--radius-lg);
            backdrop-filter: blur(12px);
        }

        .filter-btn {
            padding: .4rem 1.1rem;
            border-radius: var(--radius-full);
            border: 1px solid rgba(148,163,184,.3);
            background: transparent;
            color: var(--muted);
            font-size: .82rem;
            font-family: inherit;
            text-transform: uppercase;
            letter-spacing: .08em;
            cursor: pointer;
            transition: all .2s ease;
        }

            .filter-btn:hover {
                color: var(--text);
                border-color: var(--accent);
                background: rgba(91,140,255,.07);
            }

            .filter-btn.active {
                background: linear-gradient(135deg, var(--accent), var(--accent-purple));
                color: #fff;
                border-color: transparent;
                box-shadow: 0 4px 16px rgba(91,140,255,.35);
            }

        /* ── GRID ── */
        .projects-section {
            max-width: 1120px;
            margin: 2.5rem auto 5rem;
            padding: 0 clamp(1.5rem,4vw,4rem);
            position: relative;
            z-index: 1;
        }

        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px,1fr));
            gap: 1.8rem;
        }

        /* ── CARD ── */
        .project-card {
            background: rgba(15,23,42,.7);
            border: 1px solid rgba(148,163,184,.18);
            border-radius: var(--radius-lg);
            overflow: hidden;
            cursor: pointer;
            transition: transform .3s, box-shadow .3s, border-color .3s, opacity .3s;
            animation: fadeUp .5s ease both;
            position: relative;
            /* will-change pour perf GPU */
            will-change: transform;
        }

            .project-card:hover {
                transform: translateY(-7px) scale(1.015);
                box-shadow: 0 24px 55px rgba(91,140,255,.2);
                border-color: rgba(91,140,255,.5);
            }
        /* quand une card est ouverte, les autres s'estompent */
        body.modal-open .project-card:not(.is-expanded) {
            opacity: .25;
            pointer-events: none;
            transform: scale(.97);
        }

        .project-card.hidden {
            display: none !important;
        }

        /* image thumbnail */
        .card-img {
            position: relative;
            width: 100%;
            aspect-ratio: 16/9;
            overflow: hidden;
        }

            .card-img img {
                width: 100%;
                height: 100%;
                object-fit: cover;
                display: block;
                transition: transform .4s ease;
            }

        .project-card:hover .card-img img {
            transform: scale(1.07);
        }

        .card-img-overlay {
            position: absolute;
            inset: 0;
            background: rgba(5,6,8,.55);
            backdrop-filter: blur(2px);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity .3s;
        }

        .project-card:hover .card-img-overlay {
            opacity: 1;
        }

        .card-img-overlay span {
            color: #fff;
            font-size: .95rem;
            font-weight: 600;
            letter-spacing: .05em;
            transform: translateY(8px);
            transition: transform .3s;
        }

        .project-card:hover .card-img-overlay span {
            transform: translateY(0);
        }

        .card-body {
            padding: 1.1rem 1.3rem 1.3rem;
        }

        .card-name {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: .65rem;
            color: var(--text);
        }

        .card-tags {
            display: flex;
            flex-wrap: wrap;
            gap: .4rem;
        }

        /* ── TAG BADGES ── */
        .ptag {
            display: inline-flex;
            align-items: center;
            padding: .25rem .7rem;
            border-radius: var(--radius-full);
            font-size: .72rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: .08em;
            border: 1px solid currentColor;
        }

        .ptag-unity {
            color: #38bdf8;
            background: rgba(56,189,248,.1);
        }

        .ptag-unreal {
            color: #a855f7;
            background: rgba(168,85,247,.1);
        }

        .ptag-cpp {
            color: #3b82f6;
            background: rgba(59,130,246,.1);
        }

        .ptag-cs {
            color: #8b5cf6;
            background: rgba(139,92,246,.1);
        }

        .ptag-python {
            color: #facc15;
            background: rgba(250,204,21,.1);
        }

        .ptag-godot {
            color: #22c55e;
            background: rgba(34,197,94,.1);
        }

        .ptag-opengl {
            color: #ef4444;
            background: rgba(239,68,68,.1);
        }

        .no-results {
            display: none;
            text-align: center;
            color: var(--muted);
            font-size: 1.05rem;
            margin-top: 3rem;
            grid-column: 1/-1;
        }

        /* ══════════════════════════════════════════
           EXPANDED CARD (la magie)
        ══════════════════════════════════════════ */

        .expanded-card {
            position: fixed;
            z-index: 300;
            border-radius: var(--radius-lg);
            overflow: hidden;
            background: radial-gradient(circle at top left, #1b2440 0, #0a0d18 60%);
            border: 1px solid rgba(91,140,255,.4);
            box-shadow: 0 40px 90px rgba(0,0,0,.85), 0 0 0 1px rgba(91,140,255,.15);
            display: flex;
            flex-direction: column;
            cursor: default;
        }

            .expanded-card.animating {
                transition: top .5s cubic-bezier(.32,0,.12,1), left .5s cubic-bezier(.32,0,.12,1), width .5s cubic-bezier(.32,0,.12,1), height .5s cubic-bezier(.32,0,.12,1), border-radius .5s ease;
            }

            .expanded-card.closing {
                transition: top .4s cubic-bezier(.32,0,.12,1), left .4s cubic-bezier(.32,0,.12,1), width .4s cubic-bezier(.32,0,.12,1), height .4s cubic-bezier(.32,0,.12,1), border-radius .4s ease, opacity .35s ease;
            }

            /* Wrapper principal scrollable */
            .expanded-card .exp-content {
                flex: 1;
                min-height: 0; /* crucial pour que flex+overflow fonctionne */
                overflow-y: auto;
                opacity: 0;
                transition: opacity .25s ease .3s;
                display: flex;
                flex-direction: column;
                scrollbar-width: thin;
                scrollbar-color: var(--accent) transparent;
            }

            .expanded-card.show-content .exp-content {
                opacity: 1;
            }

        /* Bouton fermer */
        .exp-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            z-index: 10;
            width: 38px;
            height: 38px;
            border-radius: 50%;
            background: rgba(15,23,42,.9);
            border: 1px solid rgba(148,163,184,.3);
            color: var(--text);
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity .2s ease .35s, background .2s, border-color .2s, color .2s;
        }

        .expanded-card.show-content .exp-close {
            opacity: 1;
        }

        .exp-close:hover {
            background: rgba(239,68,68,.2);
            border-color: #ef4444;
            color: #ef4444;
        }

        /* Media gallery — hauteur adaptative */
        .exp-media {
            display: flex;
            gap: .75rem;
            overflow-x: auto;
            padding: 1.4rem 1.4rem 0;
            flex-shrink: 0;
            scrollbar-width: thin;
            scrollbar-color: var(--accent) transparent;
        }

            .exp-media img, .exp-media video, .exp-media iframe {
                flex-shrink: 0;
                border-radius: 12px;
                border: 1px solid rgba(148,163,184,.2);
                height: clamp(140px, 28vh, 260px);
                object-fit: cover;
            }

            .exp-media > *:only-child {
                width: 100%;
                flex-shrink: 1;
            }

            .exp-media > *:not(:only-child) {
                width: 480px;
            }

        /* Zone texte + boutons — flex column qui pousse les boutons en bas */
        .exp-info {
            padding: 1.2rem 1.4rem 1.4rem;
            display: flex;
            flex-direction: column;
            flex: 1; /* prend tout l'espace restant */
        }

        .exp-header {
            display: flex;
            flex-wrap: wrap;
            align-items: flex-start;
            gap: .8rem;
            margin-bottom: .9rem;
        }

        .exp-title {
            font-size: clamp(1.3rem,3vw,2rem);
            font-weight: 800;
            flex: 1;
            background: linear-gradient(135deg, #fff, var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .exp-tags {
            display: flex;
            flex-wrap: wrap;
            gap: .4rem;
            align-self: center;
        }

        .exp-desc {
            color: var(--muted);
            line-height: 1.75;
            font-size: .95rem;
            margin-bottom: 1.2rem;
            flex: 1; /* pousse les boutons vers le bas */
        }
        /* Boutons collés au bas de la popup */
        .exp-actions {
            display: flex;
            flex-wrap: wrap;
            gap: .8rem;
            padding-top: .8rem;
            border-top: 1px solid rgba(148,163,184,.1);
            margin-top: auto; /* garantit qu'ils restent en bas */
        }

        /* ── Boutons ── */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: .5rem;
            padding: .65rem 1.4rem;
            border-radius: var(--radius-full);
            font-size: .9rem;
            font-family: inherit;
            border: 1px solid transparent;
            cursor: pointer;
            text-decoration: none;
            transition: all .3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent), var(--accent-purple));
            color: #f9fafb;
            box-shadow: var(--shadow-soft);
        }

            .btn-primary:hover {
                transform: translateY(-3px);
                box-shadow: 0 20px 45px rgba(91,140,255,.4);
            }

        .btn-ghost {
            background: rgba(15,23,42,.6);
            border-color: rgba(148,163,184,.45);
            color: var(--muted);
        }

            .btn-ghost:hover {
                background: rgba(30,64,175,.25);
                color: var(--text);
                border-color: var(--accent);
            }

        .btn-itch {
            border-color: rgba(250,65,28,.45);
            color: #fa6040;
        }

            .btn-itch:hover {
                background: rgba(250,65,28,.12);
                border-color: #fa6040;
                color: var(--text);
            }

        /* ── FOOTER ── */
        .main-footer {
            background: #111;
            color: #eee;
            text-align: center;
            padding: 2rem 1rem;
            border-top: 1px solid rgba(148,163,184,.1);
            position: relative;
            z-index: 1;
        }

        .footer-content {
            max-width: 900px;
            margin: 0 auto;
        }

        .footer-name {
            font-weight: bold;
            margin-bottom: .4rem;
        }

        .footer-mail a {
            color: #eee;
            text-decoration: none;
            transition: color .3s;
        }

            .footer-mail a:hover {
                color: var(--accent);
            }

        .footer-links {
            margin-top: 1rem;
            display: flex;
            justify-content: center;
            gap: 1rem;
        }

        .btn-footer {
            background: #222;
            color: #eee;
            padding: .6rem 1.2rem;
            border-radius: 5px;
            text-decoration: none;
            transition: all .3s;
        }

            .btn-footer:hover {
                background: linear-gradient(135deg, var(--accent), var(--accent-purple));
                transform: translateY(-3px);
            }

        /* ── ANIMATIONS ── */
        @keyframes fadeUp {
            from {
                opacity: 0;
                transform: translateY(24px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ── RESPONSIVE ── */
        @media (max-width: 768px) {
            .nav {
                justify-content: flex-end;
            }

            .nav__toggle {
                display: flex;
            }

            .nav__links {
                position: absolute;
                top: calc(100% + .5rem);
                right: 0;
                flex-direction: column;
                gap: .5rem;
                padding: .8rem 1rem;
                background: rgba(15,23,42,.97);
                border-radius: 14px;
                backdrop-filter: blur(14px);
                transform-origin: top;
                transform: scaleY(0);
                opacity: 0;
                pointer-events: none;
                transition: .15s ease;
            }

                .nav__links.open {
                    transform: scaleY(1);
                    opacity: 1;
                    pointer-events: auto;
                }

            .projects-grid {
                grid-template-columns: 1fr;
            }

            .exp-actions {
                flex-direction: column;
            }

                .exp-actions .btn {
                    justify-content: center;
                }
        }
    </style>
</head>
<body>

    <canvas id="particles"></canvas>

    <!-- HEADER -->
    <header class="main-header">
        <nav class="nav">
            <ul class="nav__links" id="navLinks">
                <li><a href="index.html">Accueil</a></li>
                <li><a href="Projet.html" class="active">Projets</a></li>
                <li><a href="#contact">Contact</a></li>
            </ul>
            <button class="nav__toggle" id="navToggle" aria-label="Menu">
                <span></span><span></span><span></span>
            </button>
        </nav>
    </header>

    <!-- PAGE HERO -->
    <section class="page-hero">
        <h1>Mes <span>Projets</span></h1>
        <p>Une sélection de mes réalisations en développement de jeux et logiciels.</p>
    </section>

    <!-- FILTERS -->
    <section class="filter-section">
        <div class="filter-wrapper" id="filterWrapper">
            <button class="filter-btn active" data-tag="all">Tous</button>
            <button class="filter-btn" data-tag="unity">Unity</button>
            <button class="filter-btn" data-tag="unreal">Unreal Engine</button>
            <button class="filter-btn" data-tag="cpp">C++</button>
            <button class="filter-btn" data-tag="cs">C#</button>
            <button class="filter-btn" data-tag="python">Python</button>
            <button class="filter-btn" data-tag="godot">Godot</button>
            <button class="filter-btn" data-tag="opengl">OpenGL</button>
        </div>
    </section>

    <!-- GRID -->
    <main class="projects-section">
        <div class="projects-grid" id="projectsGrid"></div>
        <p class="no-results" id="noResults">Aucun projet pour ce filtre.</p>
    </main>

    <!-- FOOTER -->
    <footer class="main-footer" id="contact">
        <div class="footer-content">
            <p class="footer-name">Votre Nom</p>
            <p class="footer-mail"><a href="mailto:vous@email.com">vous@email.com</a></p>
            <div class="footer-links">
                <a href="https://github.com/" target="_blank" class="btn-footer">GitHub</a>
                <a href="https://linkedin.com/" target="_blank" class="btn-footer">LinkedIn</a>
                <a href="https://itch.io/" target="_blank" class="btn-footer">itch.io</a>
            </div>
        </div>
    </footer>

    <script>
        /* ================================================================
           DONNÉES
        ================================================================ */
        const PROJECTS = [
            {
                name: "Project Alpha",
                tags: ["unity", "cs"],
                description: "Un jeu de plateforme 2D développé sous Unity avec un système de dialogue dynamique, de la génération procédurale de niveaux et une IA ennemie basée sur des arbres de comportement. Le projet explore la narration interactive et les mécaniques de roguelite.",
                media: [
                    { type: "image", src: "https://placehold.co/800x450/1a2040/5b8cff?text=Screenshot+1" },
                    { type: "image", src: "https://placehold.co/800x450/1a2040/5b8cff?text=Screenshot+2" },
                ],
                github: "https://github.com/", itch: "https://itch.io/", cahier: "#",
            },
            {
                name: "Project Beta",
                tags: ["unreal", "cpp"],
                description: "Un FPS sous Unreal Engine 5 utilisant Lumen et Nanite. Gameplay inspiré de l'immersive sim avec des interactions physiques poussées, un système d'inventaire custom en C++ et un éditeur de niveaux procédural.",
                media: [
                    { type: "image", src: "https://placehold.co/800x450/1a1a2e/a855f7?text=Screenshot+1" },
                    { type: "youtube", src: "https://www.youtube.com/embed/dQw4w9WgXcQ" },
                ],
                github: "https://github.com/", itch: "https://itch.io/", cahier: "#",
            },
            {
                name: "Project Gamma",
                tags: ["godot", "python"],
                description: "Un RPG top-down développé sous Godot 4, associé à des outils Python pour la génération automatique de cartes via bruit de Perlin. Interface de debug et pipeline d'assets entièrement automatisé.",
                media: [{ type: "image", src: "https://placehold.co/800x450/0f1a10/22c55e?text=Screenshot+1" }],
                github: "https://github.com/", itch: "https://itch.io/", cahier: "#",
            },
            {
                name: "Project Delta",
                tags: ["opengl", "cpp"],
                description: "Un moteur de rendu 3D minimaliste from scratch en OpenGL et C++. Implémentation d'un pipeline de deferred rendering, shadow mapping, SSAO et post-processing. Exercice académique sur les APIs graphiques bas niveau.",
                media: [{ type: "image", src: "https://placehold.co/800x450/1a1010/ef4444?text=Screenshot+1" }],
                github: "https://github.com/", itch: null, cahier: "#",
            },
            {
                name: "Project Epsilon",
                tags: ["unity", "cs"],
                description: "Un puzzle-game VR développé avec Unity XR Interaction Toolkit. Le joueur manipule des objets physiques pour résoudre des énigmes dans un environnement minimaliste. Prise en charge Meta Quest 2 & 3.",
                media: [
                    { type: "image", src: "https://placehold.co/800x450/101a2a/38bdf8?text=Screenshot+1" },
                    { type: "image", src: "https://placehold.co/800x450/101a2a/38bdf8?text=Screenshot+2" },
                ],
                github: "https://github.com/", itch: "https://itch.io/", cahier: "#",
            },
            {
                name: "Project Zeta",
                tags: ["unreal", "cpp", "python"],
                description: "Un prototype de simulation RTS sous Unreal Engine 5. L'IA des unités repose sur un système de pathfinding A* custom. Des scripts Python gèrent la pipeline de build et les tests automatisés.",
                media: [
                    { type: "image", src: "https://placehold.co/800x450/1a1520/f59e0b?text=Screenshot+1" },
                    { type: "youtube", src: "https://www.youtube.com/embed/dQw4w9WgXcQ" },
                ],
                github: "https://github.com/", itch: "https://itch.io/", cahier: "#",
            },
        ];

        const TAG_META = {
            unity: { label: "Unity", cls: "ptag-unity" },
            unreal: { label: "Unreal Engine", cls: "ptag-unreal" },
            cpp: { label: "C++", cls: "ptag-cpp" },
            cs: { label: "C#", cls: "ptag-cs" },
            python: { label: "Python", cls: "ptag-python" },
            godot: { label: "Godot", cls: "ptag-godot" },
            opengl: { label: "OpenGL", cls: "ptag-opengl" },
        };

        function makeTags(tags) {
            return tags.map(t => {
                const m = TAG_META[t] || { label: t, cls: "" };
                return `<span class="ptag ${m.cls}">${m.label}</span>`;
            }).join("");
        }

        /* ── BUILD CARDS ── */
        const grid = document.getElementById("projectsGrid");
        const noRes = document.getElementById("noResults");

        PROJECTS.forEach((p, i) => {
            const thumb = p.media[0]?.type === "image"
                ? p.media[0].src
                : `https://placehold.co/600x340/10121a/5b8cff?text=${encodeURIComponent(p.name)}`;

            const card = document.createElement("article");
            card.className = "project-card";
            card.dataset.tags = p.tags.join(" ");
            card.dataset.id = i;
            card.style.animationDelay = `${i * 0.08}s`;
            card.innerHTML = `
            <div class="card-img">
                <img src="${thumb}" alt="${p.name}" loading="lazy"/>
                <div class="card-img-overlay"><span>Voir les détails →</span></div>
            </div>
            <div class="card-body">
                <h3 class="card-name">${p.name}</h3>
                <div class="card-tags">${makeTags(p.tags)}</div>
            </div>`;
            card.addEventListener("click", () => expandCard(card, i));
            grid.appendChild(card);
        });

        /* ── FILTER ── */
        document.getElementById("filterWrapper").addEventListener("click", e => {
            const btn = e.target.closest(".filter-btn");
            if (!btn) return;
            document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            const tag = btn.dataset.tag;
            let visible = 0;
            document.querySelectorAll(".project-card").forEach(card => {
                const show = tag === "all" || card.dataset.tags.split(" ").includes(tag);
                card.classList.toggle("hidden", !show);
                if (show) visible++;
            });
            noRes.style.display = visible ? "none" : "block";
        });

        /* ════════════════════════════════════════
           EXPAND CARD — effet "la card grossit"
        ════════════════════════════════════════ */
        let expandedEl = null;   // le div flottant en cours
        let originCard = null;   // la card source

        function expandCard(card, idx) {
            if (expandedEl) return; // déjà ouvert
            const p = PROJECTS[idx];

            /* 1. Mesure la position exacte de la card à l'écran */
            const rect = card.getBoundingClientRect();

            /* 2. Crée le div flottant positionné exactement sur la card */
            const el = document.createElement("div");
            el.className = "expanded-card";
            el.style.top = rect.top + "px";
            el.style.left = rect.left + "px";
            el.style.width = rect.width + "px";
            el.style.height = rect.height + "px";

            /* Même thumbnail que la card au départ */
            const thumb = p.media[0]?.type === "image"
                ? p.media[0].src
                : `https://placehold.co/600x340/10121a/5b8cff?text=${encodeURIComponent(p.name)}`;

            /* Contenu complet (invisible au départ, opacity 0) */
            el.innerHTML = `
            <button class="exp-close" id="expClose">✕</button>
            <div class="exp-content">
                <div class="exp-media">
                    ${p.media.map(m => {
                if (m.type === "image") return `<img src="${m.src}" alt="${p.name}" loading="lazy"/>`;
                if (m.type === "video") return `<video src="${m.src}" controls></video>`;
                if (m.type === "youtube") return `<iframe src="${m.src}" title="YouTube" frameborder="0" allowfullscreen></iframe>`;
                return "";
            }).join("")}
                </div>
                <div class="exp-info">
                    <div class="exp-header">
                        <h2 class="exp-title">${p.name}</h2>
                        <div class="exp-tags">${makeTags(p.tags)}</div>
                    </div>
                    <p class="exp-desc">${p.description}</p>
                    <div class="exp-actions">
                        <a href="${p.cahier || '#'}" class="btn btn-primary" target="_blank">📄 Cahier des charges</a>
                        ${p.github ? `<a href="${p.github}" class="btn btn-ghost" target="_blank">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.477 2 2 6.477 2 12c0 4.418 2.865 8.166 6.839 9.489.5.092.682-.217.682-.482 0-.237-.008-.866-.013-1.7-2.782.603-3.369-1.342-3.369-1.342-.454-1.155-1.11-1.462-1.11-1.462-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.087 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.269 2.75 1.025A9.578 9.578 0 0112 6.836a9.59 9.59 0 012.504.337c1.909-1.294 2.747-1.025 2.747-1.025.546 1.377.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.741 0 .267.18.578.688.48C19.138 20.163 22 16.418 22 12c0-5.523-4.477-10-10-10z"/></svg>
                            GitHub</a>` : ""}
                        ${p.itch ? `<a href="${p.itch}" class="btn btn-ghost btn-itch" target="_blank">🎮 Tester sur itch.io</a>` : ""}
                    </div>
                </div>
            </div>`;

            document.body.appendChild(el);
            expandedEl = el;
            originCard = card;

            /* 3. Marque la card source + estompe les autres */
            card.classList.add("is-expanded");
            document.body.classList.add("modal-open");
            document.body.style.overflow = "hidden";

            /* 4. Un frame plus tard : active la transition et agrandit vers le centre */
            requestAnimationFrame(() => {
                requestAnimationFrame(() => {
                    el.classList.add("animating");

                    /* Cible : centré, grande taille, responsive */
                    const vw = window.innerWidth;
                    const vh = window.innerHeight;
                    const padding = vw < 600 ? 12 : 32;
                    const targetW = Math.min(900, vw - padding * 2);
                    const targetH = Math.min(vh - padding * 2, vw < 600 ? vh * 0.9 : 720);
                    const targetL = (vw - targetW) / 2;
                    const targetT = (vh - targetH) / 2;

                    el.style.top = targetT + "px";
                    el.style.left = targetL + "px";
                    el.style.width = targetW + "px";
                    el.style.height = targetH + "px";
                    el.style.borderRadius = "24px";

                    /* 5. Quand l'animation est finie, affiche le contenu */
                    setTimeout(() => {
                        el.classList.add("show-content");
                    }, 420);
                });
            });

            /* Fermeture */
            el.querySelector("#expClose").addEventListener("click", collapseCard);
            document.addEventListener("keydown", onEscape);
        }

        function collapseCard() {
            if (!expandedEl || !originCard) return;

            const el = expandedEl;
            const card = originCard;

            /* Cache le contenu d'abord */
            el.classList.remove("show-content");

            /* Mesure la position actuelle de la card dans le DOM
               (elle est peut-être scrollée, on recalcule) */
            const rect = card.getBoundingClientRect();

            /* Petite pause pour que l'opacity du contenu parte avant */
            setTimeout(() => {
                el.classList.remove("animating");
                el.classList.add("closing");

                el.style.top = rect.top + "px";
                el.style.left = rect.left + "px";
                el.style.width = rect.width + "px";
                el.style.height = rect.height + "px";
                el.style.borderRadius = "18px";
                el.style.opacity = "0";

                /* Nettoyage après la transition */
                setTimeout(() => {
                    el.remove();
                    card.classList.remove("is-expanded");
                    document.body.classList.remove("modal-open");
                    document.body.style.overflow = "";
                    expandedEl = null;
                    originCard = null;
                }, 420);
            }, 150);

            document.removeEventListener("keydown", onEscape);
        }

        function onEscape(e) { if (e.key === "Escape") collapseCard(); }

        /* ── NAV TOGGLE ── */
        document.getElementById("navToggle").addEventListener("click", () => {
            document.getElementById("navLinks").classList.toggle("open");
        });

        /* ── PARTICLES ── */
        (function () {
            const c = document.getElementById("particles");
            const ctx = c.getContext("2d");
            let W, H;
            const pts = Array.from({ length: 90 }, () => ({
                x: Math.random() * window.innerWidth,
                y: Math.random() * window.innerHeight,
                r: Math.random() * 1.4 + .3,
                dx: (Math.random() - .5) * .28,
                dy: (Math.random() - .5) * .28,
                a: Math.random() * .55 + .1,
            }));
            function resize() { W = c.width = window.innerWidth; H = c.height = window.innerHeight; }
            resize();
            window.addEventListener("resize", resize);
            (function tick() {
                ctx.clearRect(0, 0, W, H);
                pts.forEach(p => {
                    ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(91,140,255,${p.a})`; ctx.fill();
                    p.x += p.dx; p.y += p.dy;
                    if (p.x < 0 || p.x > W) p.dx *= -1;
                    if (p.y < 0 || p.y > H) p.dy *= -1;
                });
                requestAnimationFrame(tick);
            })();
        })();
    </script>
</body>
</html>